CREATE TABLE IF NOT EXISTS USERS
(
    USER_ID  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    EMAIL    VARCHAR                                              NOT NULL,
    LOGIN    VARCHAR UNIQUE                                       NOT NULL,
    USERNAME VARCHAR,
    BIRTHDAY DATE                                                 NOT NULL
);

CREATE TABLE IF NOT EXISTS GENRES
(
    GENRE_ID   INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    GENRE_NAME VARCHAR                                          NOT NULL
);

CREATE TABLE IF NOT EXISTS MPA_RATINGS
(
    MPA_ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    MPA_NAME VARCHAR                                              NOT NULL
);

CREATE TABLE IF NOT EXISTS FILMS
(
    FILM_ID      INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    FILM_NAME    VARCHAR(255)                                     NOT NULL,
    DESCRIPTION  VARCHAR(200)                                     NOT NULL,
    RELEASE_DATE DATE                                             NOT NULL,
    DURATION     INTEGER                                          NOT NULL,
    MPA_ID       INTEGER                                          NOT NULL
    REFERENCES MPA_RATINGS (MPA_ID) ON DELETE CASCADE,

    COUNT_LIKES  INTEGER DEFAULT 0
    );

CREATE TABLE IF NOT EXISTS FILMS_LIKES
(
    FILM_ID INTEGER REFERENCES FILMS (FILM_ID) ON DELETE CASCADE NOT NULL,
    USER_ID INTEGER REFERENCES USERS (USER_ID) ON DELETE CASCADE NOT NULL,
    PRIMARY KEY (FILM_ID, USER_ID)
    );

CREATE TABLE IF NOT EXISTS FILMS_GENRES
(
    FILM_ID  INTEGER REFERENCES FILMS (FILM_ID) ON DELETE CASCADE  NOT NULL,
    GENRE_ID INTEGER REFERENCES GENRES (GENRE_ID) ON DELETE CASCADE NOT NULL,
    PRIMARY KEY (FILM_ID, GENRE_ID)
    );

CREATE TABLE IF NOT EXISTS FRIENDS
(
    USER_ID   INTEGER REFERENCES USERS (USER_ID) ON DELETE CASCADE NOT NULL,
    FRIEND_ID INTEGER REFERENCES USERS (USER_ID) ON DELETE CASCADE NOT NULL,
    PRIMARY KEY (USER_ID, FRIEND_ID)
    );

CREATE TABLE IF NOT EXISTS DIRECTORS
(
    DIRECTOR_ID     INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    DIRECTOR_NAME  VARCHAR                                              NOT NULL
);

CREATE TABLE IF NOT EXISTS FILMS_DIRECTORS
(
    FILM_ID      INTEGER REFERENCES FILMS (FILM_ID) ON DELETE CASCADE NOT NULL,
    DIRECTOR_ID  INTEGER REFERENCES DIRECTORS (DIRECTOR_ID) ON DELETE CASCADE NOT NULL,
    CONSTRAINT FK_FILMS_DIRECTORS FOREIGN KEY (FILM_ID) REFERENCES FILMS (FILM_ID) ON DELETE CASCADE,
    CONSTRAINT FK_DIRECTORS FOREIGN KEY (DIRECTOR_ID) REFERENCES DIRECTORS (DIRECTOR_ID) ON DELETE CASCADE
);